# Документация по приложению ExcelFlow

## Содержание
1. [Общее описание](#общее-описание)
2. [Функциональные возможности](#функциональные-возможности)
3. [Архитектура приложения](#архитектура-приложения)
4. [Установка и настройка](#установка-и-настройка)
5. [Использование](#использование)
6. [Описание алгоритмов](#описание-алгоритмов)
7. [Логирование](#логирование)
8. [Тестирование](#тестирование)

## Общее описание

ExcelFlow - это консольное приложение на Python для автоматического анализа Excel-файла с несколькими вкладками. Приложение сопоставляет данные между вкладками по определённым критериям и добавляет результаты расчёта в целевую вкладку без потери исходного форматирования.

Основная цель приложения - подтянуть данные о прямой себестоимости из справочной вкладки во вкладку обработки и создать новый столбец с рассчитанными значениями.

## Функциональные возможности

- Извлечение и нормализация дат из документа приобретения
- Определение квартала на основе даты
- Сопоставление данных по двум уровням:
  - Уровень 1: При наличии полной даты приобретения (сопоставление по номенклатуре и периоду)
  - Уровень 2: При отсутствии полной даты приобретения (сопоставление по коду номенклатуры и контрагенту)
- Добавление пяти новых столбцов в вкладку "СК ТПХ_1 пг":
  - **Дата приобретения:**  Содержит дату приобретения товара или услуги, извлеченную из документа. Если дата не может быть извлечена, в столбец будет записано значение "Дата не найдена".
  - **Квартал приобретения:**  Определяет квартал, к которому относится дата приобретения (в формате "N квартал YYYY").
  - **Стоимость закупки НЧТЗ 1 ед:** Содержит значение стоимости закупки из столбца AQ справочной вкладки.
 - **Прямая СС НЧТЗ 1 ед:** Содержит значение прямой себестоимости из столбца AR справочной вкладки.
  - **НР НЧТЗ 1 ед:** Содержит значение накладных расходов из столбца AS справочной вкладки.

- Подробное логирование процесса обработки
- Генерация отчетов о несопоставленных записях

## Архитектура приложения

### Структура проекта
```
ExcelFlow/
├── main.py                 # Точка входа, парсинг аргументов
├── processors/
│   ├── __init__.py
│   ├── data_loader.py      # Загрузка и валидация файлов
│   ├── parser.py           # Парсинг и нормализация данных
│   └── matcher.py          # Логика сопоставления
├── utils/
│   ├── __init__.py
│   ├── date_extractor.py   # Извлечение и парсинг дат
│   ├── fuzzy_matcher.py    # "Размытое" сравнение
│   └── logger_config.py    # Конфигурация логирования
├── tests/
│   ├── test_parser.py
│   ├── test_matcher.py
│   └── test_date_extractor.py
├── requirements.txt        # Зависимости проекта
├── README.md               # Краткая документация
└── DOCUMENTATION.md        # Полная документация
```

### Модули приложения

#### processors/data_loader.py
Класс `DataLoader` отвечает за загрузку и валидацию Excel-файла. Проверяет наличие обязательных вкладок и столбцов, обеспечивает корректное чтение данных.

#### processors/parser.py
Класс `DataParser` выполняет парсинг и нормализацию данных в обеих вкладках:
- Извлечение дат из документов
- Нормализация номенклатур
- Извлечение кодов номенклатур
- Преобразование периодов в диапазоны дат

#### processors/matcher.py