# Промпт для создания веб-интерфейса для ExcelFlow

```
Создай веб-приложение с современным интерфейсом для ExcelFlow — Python-приложения для анализа и сопоставления данных Excel.

## Требования к веб-приложению

### Технологический стек
- **Backend:** Flask или FastAPI (Python)
- **Frontend:** HTML5, CSS3, JavaScript (можно использовать Bootstrap 5 или Tailwind CSS для стилизации)
- **WebSockets:** для отображения прогресса в реальном времени (Flask-SocketIO или FastAPI WebSocket)
- **Файловое хранилище:** временное хранение загруженных и обработанных файлов

### Основной функционал

#### 1. Главная страница
Создай страницу загрузки файла с:
- Drag & drop зоной для загрузки Excel-файла (.xlsx)
- Кнопкой выбора файла через диалог
- Валидацией формата файла (только .xlsx)
- Отображением имени и размера загруженного файла
- Опциональными параметрами (выпадающие списки):
  - Имя вкладки-справочника (по умолчанию: "ВП 2024-2025 НЧТЗ")
  - Имя вкладки для обработки (по умолчанию: "СК ТПХ_1 пг")
  - Уровень логирования (INFO, DEBUG, WARNING, ERROR)
- Кнопкой "Начать обработку"

#### 2. Страница обработки (прогресс)
После нажатия "Начать обработку" показывать:
- **Прогресс-бар** с процентами выполнения (0-100%)
- **Лог в реальном времени** — окно с прокруткой, куда выводятся сообщения из logger
- **Этапы обработки** с индикаторами статуса:
  - ✅ Загрузка файла
  - ✅ Парсинг целевой вкладки
  - ✅ Парсинг справочной вкладки
  - ⏳ Сопоставление записей (с процентом)
  - ⏳ Сохранение результата
- **Статистику в реальном времени:**
  - Обработано строк: X из Y
  - Найдено совпадений: N
  - Требует ручной проверки: M
  - Время выполнения: HH:MM:SS (обновляется каждую секунду)
- **Кнопку "Отменить обработку"** (красная, останавливает процесс)

#### 3. Страница результата
После успешного завершения показывать:
- **Итоговую статистику:**
  - Всего обработано записей
  - Успешно сопоставлено (%)
  - Требует ручной проверки (%)
  - Отсутствуют данные (%)
  - Время обработки
  - Распределение по типам совпадений (Уровень 1, Уровень 2, размытое)
- **Кнопку "Скачать результат"** (зелёная, большая) — скачивает обработанный Excel-файл
- **Кнопку "Скачать полный лог"** — скачивает текстовый файл с логами
- **Кнопку "Обработать новый файл"** — возвращает на главную страницу

#### 4. Страница ошибки
Если обработка завершилась с ошибкой:
- **Красное сообщение об ошибке** с деталями
- **Полный стек ошибки** (можно свернуть/развернуть)
- **Частичный лог** последних 50 строк
- **Кнопку "Скачать полный лог ошибок"**
- **Кнопку "Попробовать снова"**

### Архитектура

#### Backend (Flask/FastAPI)
Создай следующие эндпоинты:

1. **POST /upload** — загрузка файла
   - Принимает файл и параметры
   - Сохраняет во временную директорию
   - Возвращает уникальный ID задачи (UUID)

2. **POST /process/{task_id}** — запуск обработки
   - Запускает обработку в фоновом режиме (Celery или asyncio)
   - Возвращает статус "started"

3. **WebSocket /ws/{task_id}** — стрим прогресса
   - Отправляет события:
     - `progress` — процент выполнения (0-100)
     - `log` — строка лога
     - `stats` — текущая статистика
     - `stage` — текущий этап обработки
     - `completed` — обработка завершена
     - `error` — произошла ошибка

4. **GET /download/{task_id}** — скачать результат
   - Возвращает обработанный Excel-файл

5. **GET /log/{task_id}** — скачать полный лог
   - Возвращает текстовый файл с логами

6. **DELETE /cancel/{task_id}** — отменить обработку
   - Останавливает выполнение задачи

#### Интеграция с существующим кодом ExcelFlow
- Оберни существующий код (main.py, processors/*) в функцию, которая:
  - Принимает параметры (пути к файлам, настройки)
  - Отправляет события прогресса через callback или WebSocket
  - Перехватывает логи через custom handler
  - Возвращает результат и статистику

Пример интеграции:
```
def process_excel_task(task_id, input_path, output_path, settings, progress_callback):
    # Перенаправить логи в WebSocket
    # Вызвать существующую логику из main.py
    # Отправлять прогресс через progress_callback
    pass
```

### Дизайн интерфейса

#### Цветовая схема
- Основной цвет: синий (#2563eb)
- Успех: зелёный (#10b981)
- Ошибка: красный (#ef4444)
- Предупреждение: оранжевый (#f59e0b)
- Фон: светло-серый (#f9fafb)

#### Компоненты
- **Карточки** с тенью для основных блоков
- **Анимированный прогресс-бар** (плавное заполнение)
- **Иконки** для этапов обработки (✅ ❌ ⏳ ⚠️)
- **Адаптивная вёрстка** (работает на мобильных устройствах)

### Обработка ошибок и граничных случаев

1. **Неверный формат файла** — показать ошибку до загрузки
2. **Файл слишком большой (>50MB)** — показать предупреждение
3. **Обязательная вкладка отсутствует** — показать детальную ошибку
4. **Обработка прервана пользователем** — корректно остановить и очистить ресурсы
5. **Сервер перезапущен во время обработки** — показать статус "потеряна" при возврате
6. **Несколько одновременных задач** — каждая в своём потоке, не блокируют друг друга

### Дополнительные возможности

1. **История обработок** (опционально)
   - Список последних 10 обработанных файлов с датами
   - Возможность скачать старые результаты

2. **Превью данных** (опционально)
   - Показать первые 5 строк загруженного файла
   - Позволить убедиться, что выбраны правильные вкладки

3. **Настройки** (опционально)
   - Сохранять предпочтения пользователя (имена вкладок)
   - Экспорт/импорт конфигурации

### Производительность и безопасность

1. **Очистка временных файлов** — удалять старые файлы (>24 часа)
2. **Лимиты** — максимум 2 одновременные обработки на сервер
3. **Валидация** — проверять загружаемые файлы на вирусы (опционально)
4. **CORS** — настроить правильные заголовки
5. **Rate limiting** — ограничить количество запросов с одного IP

### Примеры кода

Включи готовые примеры:
- HTML-шаблон главной страницы
- JavaScript для WebSocket подключения и обновления прогресса
- Flask/FastAPI роуты
- Функцию интеграции с ExcelFlow

### Структура проекта
```
ExcelFlow-Web/
├── app.py                 # Основной файл Flask/FastAPI
├── static/
│   ├── css/
│   │   └── style.css     # Стили
│   └── js/
│       └── main.js       # JavaScript для UI и WebSocket
├── templates/
│   ├── index.html        # Главная страница
│   ├── progress.html     # Страница обработки
│   ├── result.html       # Страница результата
│   └── error.html        # Страница ошибки
├── tasks/
│   └── processor.py      # Обёртка над ExcelFlow
├── uploads/              # Временные загруженные файлы
├── results/              # Обработанные файлы
└── requirements.txt      # Зависимости (Flask, Flask-SocketIO, etc.)
```

Реализуй полнофункциональное веб-приложение с современным UX/UI, 
которое будет интуитивно понятным для пользователей без технических 
навыков.
```

***

## Дополнительные уточнения для более точного результата


```
Дополнительно:
- Используй FastAPI (более современный, быстрый, с автоматической документацией API)
- Для фронтенда используй Bootstrap 5 (готовые компоненты)
```
