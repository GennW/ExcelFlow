# ExcelFlow

Приложение для автоматического анализа Excel-файла с несколькими вкладками. Приложение сопоставляет данные между вкладками по определённым критериям и добавляет результаты расчёта в целевую вкладку без потери исходного форматирования.

## Описание

Основная цель приложения - подтянуть данные о прямой себестоимости из справочной вкладки во вкладку обработки и создать новый столбец с рассчитанными значениями.

## Функциональные возможности

- Извлечение и нормализация дат из документа приобретения
- Определение квартала на основе даты
- Сопоставление данных по двум уровням:
  - Уровень 1: При наличии полной даты приобретения (сопоставление по номенклатуре и периоду)
  - Уровень 2: При отсутствии полной даты приобретения (сопоставление по коду номенклатуры и контрагенту)
- Добавление пяти новых столбцов в вкладку "СК ТПХ_1 пг":
  - "Дата приобретения"
  - "Квартал приобретения" (в формате "N квартал YYYY")
  - "Стоимость закупки НЧТЗ 1 ед"
  - "Прямая СС НЧТЗ 1 ед"
  - "НР НЧТЗ 1 ед"

## Требования

- Python 3.8+
- См. файл `requirements.txt` для списка зависимостей

## Использование

```bash
python main.py --input <путь> --output <путь> [--source-sheet] [--target-sheet] [--log-level]
```

### Параметры

| Параметр | Тип | Описание | Обязательный |
|----------|-----|---------|------------|
| `--input` | string | Путь к входному Excel-файлу | Да |
| `--output` | string | Путь к выходному Excel-файлу | Да |
| `--source-sheet` | string | Имя вкладки-справочника | Нет (по умолчанию: "ВП 2024-2025 НЧТЗ") |
| `--target-sheet` | string | Имя вкладки для обработки | Нет (по умолчанию: "СК ТПХ_1 пг") |
| `--log-level` | string | Уровень логирования (DEBUG, INFO, WARNING, ERROR) | Нет (по умолчанию: INFO) |
| `--report-file` | string | Путь к файлу отчёта о несопоставленных записях | Нет |

### Примеры использования

```bash
# Базовое использование
python main.py --input данные.xlsx --output результат.xlsx

# С пользовательским путём отчёта
python main.py --input данные.xlsx --output результат.xlsx --report-file отчет.xlsx

# С повышенным уровнем логирования
python main.py --input данные.xlsx --output результат.xlsx --log-level DEBUG
```

## Структура проекта

```
ExcelFlow/
├── main.py                 # Точка входа, парсинг аргументов
├── processors/
│   ├── __init__.py
│   ├── data_loader.py      # Загрузка и валидация файлов
│   ├── parser.py           # Парсинг и нормализация данных
│   └── matcher.py          # Логика сопоставления
├── utils/
│   ├── __init__.py
│   ├── date_extractor.py   # Извлечение и парсинг дат
│   ├── fuzzy_matcher.py    # "Размытое" сравнение
│   └── logger_config.py    # Конфигурация логирования
├── tests/
│   ├── test_parser.py
│   ├── test_matcher.py
│   └── test_date_extractor.py
├── requirements.txt        # Зависимости проекта
└── README.md               # Документация