# Документация по скриптам анализа Excel файлов

## 1. Скрипт `test/analyze_dates_copy.py`

### Назначение
Скрипт предназначен для быстрого анализа состояния ячеек в колонке 'Дата приобретения' Excel файла. Он классифицирует ячейки на следующие категории:
- Пустые ячейки
- Ячейки с формулами (начинающиеся с `=`)
- Ячейки с готовыми датами
- Ячейки с другими значениями

### Оптимизация для слабых ПК

Скрипт реализован с несколькими подходами оптимизации производительности и потребления памяти:

1. **Read-only режим**:
   - Используется параметр `read_only=True` при загрузке Excel файлов через `load_workbook()`, что значительно снижает потребление памяти при работе с большими файлами

2. **Экономия памяти при обработке**:
   - Используется метод `iter_rows()` для построчного чтения данных, избегая загрузки всего листа в память одновременно

3. **Ограниченное сканирование**:
   - Проверка строк ограничена 700 строками (переменная `max_row_to_check`), предотвращая бесконечный перебор и ускоряя определение объема данных

4. **Двухэтапный анализ**:
   - Сначала файл анализируется в режиме формул (`data_only=False`), затем отдельно для вычисленных значений (`data_only=True`)
   - Это позволяет избежать двойной загрузки данных и ускоряет анализ

5. **Ограниченные примеры**:
   - Сбор примеров данных ограничен 2-3 значениями для каждой категории, предотвращая накопление больших объемов данных в памяти

6. **Прогресс-бар**:
   - Вывод прогресса каждые 500 строк позволяет отслеживать выполнение на медленных системах

7. **Эффективное определение объема данных**:
   - Сначала определяется реальное количество строк с данными, после чего анализируется только нужный диапазон

### Вывод отчета

Скрипт генерирует подробный отчет, который включает:

1. **Основную статистику**:
   - Количество пустых ячеек
   - Количество ячеек с формулами
   - Количество ячеек с готовыми датами
   - Количество ячеек с другими значениями
   - Процентное соотношение каждой категории

2. **Примеры значений**:
   - Примеры формул (до 3 шт.)
   - Примеры дат (до 3 шт.)
   - Примеры других значений (до 2 шт.)

3. **Сводку**:
   - Общее количество ячеек
   - Проверка целостности (сумма всех категорий должна равняться общему количеству ячеек)
   - Краткий вывод о содержимом колонки

4. **Дополнительное распределение**:
   - После основной статистики показывается количество примеров для каждой категории

## 2. Скрипт `test/check_quarter_format.py`

### Назначение
Скрипт анализирует формат значений в столбце "Квартал приобретения" Excel файла. Он проверяет, соответствуют ли значения формату "N квартал YYYY", где N - число от 1 до 4, а YYYY - год в диапазоне 2020-2030.

### Основные функции

1. **`is_excel_not_empty(value)`**:
   - Проверяет "непустоту" значения так же, как это делает фильтр Excel
   - Учитывает специфические "пустые" значения Excel: NaN, None, пустые строки, строки из пробелов, "nan", "-", "none"

2. **`is_valid_quarter_format(value)`**:
   - Проверяет, соответствует ли значение формату "N квартал YYYY"
   - Использует регулярное выражение для валидации

3. **`check_quarter_format(file_path, sheet_name=None, skip_rows=10)`**:
   - Основная функция анализа, которая:
     - Загружает Excel файл с пропуском первых строк
     - Находит столбец "Квартал приобретения"
     - Классифицирует значения на валидные и невалидные
     - Генерирует подробный отчет

### Особенности реализации

1. **Специфика Excel фильтра**:
   - Скрипт учитывает, как Excel определяет "пустые" значения
   - Позволяет точно соответствовать результатам ручной фильтрации в Excel

2. **Анализ формата квартала**:
   - Проверяет формат "N квартал YYYY" с помощью регулярного выражения
   - Учитывает возможные пробелы и форматирование

3. **Группировка невалидных значений**:
   - Собирает статистику по невалидным значениям
   - Показывает топ-20 самых частых невалидных значений

4. **Диагностика**:
   - Показывает первые 15 строк данных с индикацией валидности
   - Отображает тип данных и номер строки в Excel

### Вывод отчета

Скрипт генерирует подробный отчет, включающий:

1. **Статистику по Excel фильтру**:
   - Общее количество строк
   - Количество пустых и непустых значений по Excel критериям
   - Процентное соотношение

2. **Статистику по формату**:
   - Количество значений в валидном формате
   - Количество значений в невалидном формате
   - Процентное соотношение

3. **Примеры невалидных значений**:
   - Топ-20 самых частых невалидных значений
   - Количество вхождений каждого значения

4. **Диагностику**:
   - Первые 15 строк с индикацией валидности
   - Тип данных и представление значения

5. **Выводы**:
   - Оценка качества данных
   - Процент валидных значений среди непустых